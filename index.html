<!DOCTYPE HTML>
<html lang="en-CA">
<head>
    <title>retro-term</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="en-CA" />
    <meta charset="UTF-8">
    <meta name="author" content="Nathan Douglas Klapstein"/>
    <meta name="description" content="Nathan Douglas Klapstein's Retro Terminal">

    <link rel="stylesheet" href="assets/main.css">

    <link href="assets/crt.css" rel="stylesheet"/>

    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/1.14.0/js/jquery.terminal.min.js"></script>
    <link href="assets/jquery.terminal.css" rel="stylesheet"/>
</head>
<body class="frame crt">
    <div id="term" style="overflow: hidden;"></div>
    <script src="assets/bash.js"></script>
    <script>

        var readme = fetch('README.rst').then(response => response.text());
        var resume = fetch('RESUME.rst').then(response => response.text());

        var emulator = bashEmulator({
            workingDirectory: '/',
            fileSystem: {
                '/': {
                    type: 'dir',
                    modified: Date.now()
                },
                '/README.rst': {
                    type: 'file',
                    modified: Date.now(),
                    content: readme
                },
                '/RESUME.rst': {
                    type: 'file',
                    modified: Date.now(),
                    content: resume
                },
                '/home': {
                    type: 'dir',
                    modified: Date.now()
                },
                '/home/user/journal.txt': {
                    type: 'file',
                    modified: Date.now(),
                    content: 'this is private!'
                },
                '/home/user': {
                    type: 'dir',
                    modified: Date.now()
                }
            }
        });
        let height = $(window).height();
        let offset = height*0.1;
        height = height - offset;

        $('#term').css("top", offset*0.55);
        $('#term').css("height", height);

        $( window ).resize(function() {
            height = $(window).height();
            offset = height*0.1;
            height = height - offset;
            // rounding is hard
            $('#term').css("top", offset*0.55);
            $('#term').css("height", height);
        });

        jQuery(function ($, undefined) {
            $('#term').terminal(function (command) {
                var terminal = this;
                function out(result){
                    terminal.echo(result);
                }
                function error(reason){
                    terminal.echo(reason);
                }
                command = command.trim();
                emulator.run(command).then(out, error);
            }, {
                greetings: 'Welcome to klapstein.ca type `help` for list of commands',
                name: 'term',
                height: height,
                prompt: 'ks> '
            });
        });
    </script>
</body>
</html>